{
  "id": null,
  "uid": "dps-overview",
  "title": "Dynamic Product System - Overview",
  "description": "Comprehensive overview of the DPS platform: API health, business metrics, portfolio status, reservations, and infrastructure.",
  "tags": ["dps", "overview", "production"],
  "timezone": "utc",
  "schemaVersion": 39,
  "version": 1,
  "editable": true,
  "graphTooltip": 1,
  "refresh": "30s",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "fiscalYearStartMonth": 0,
  "liveNow": false,
  "weekStart": "",
  "templating": {
    "list": [
      {
        "name": "datasource",
        "type": "datasource",
        "label": "Prometheus",
        "description": "Prometheus data source",
        "query": "prometheus",
        "current": {},
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "options": [],
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false
      },
      {
        "name": "tenant_id",
        "type": "query",
        "label": "Tenant",
        "description": "Filter by tenant ID",
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "query": "label_values(dps_api_requests_total, tenant_id)",
        "current": {},
        "hide": 0,
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "options": [],
        "refresh": 2,
        "regex": "",
        "sort": 1,
        "skipUrlSync": false
      },
      {
        "name": "endpoint",
        "type": "query",
        "label": "Endpoint",
        "description": "Filter by API endpoint",
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "query": "label_values(dps_api_requests_total{tenant_id=~\"$tenant_id\"}, endpoint)",
        "current": {},
        "hide": 0,
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "options": [],
        "refresh": 2,
        "regex": "",
        "sort": 1,
        "skipUrlSync": false
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      },
      {
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "enable": true,
        "expr": "ALERTS{alertname=~\"DPS.*\", alertstate=\"firing\"}",
        "hide": false,
        "iconColor": "red",
        "name": "DPS Alerts",
        "step": "60s",
        "titleFormat": "{{ alertname }}",
        "textFormat": "{{ summary }}"
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "type": "row",
      "title": "System Health",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "panels": []
    },
    {
      "id": 2,
      "title": "API Request Rate",
      "description": "Requests per second grouped by endpoint",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 0, "y": 1 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "req/s",
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "reqps"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(dps_api_requests_total{tenant_id=~\"$tenant_id\", endpoint=~\"$endpoint\"}[5m])) by (endpoint)",
          "legendFormat": "{{ endpoint }}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 3,
      "title": "Error Rate",
      "description": "4xx and 5xx errors per second by endpoint",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 6, "y": 1 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "errors/s",
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto",
            "stacking": { "group": "A", "mode": "normal" }
          },
          "unit": "reqps",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0.5 },
              { "color": "red", "value": 2 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(dps_api_requests_total{tenant_id=~\"$tenant_id\", endpoint=~\"$endpoint\", status_code=~\"4..\"}[5m])) by (endpoint)",
          "legendFormat": "4xx {{ endpoint }}",
          "refId": "A"
        },
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(dps_api_requests_total{tenant_id=~\"$tenant_id\", endpoint=~\"$endpoint\", status_code=~\"5..\"}[5m])) by (endpoint)",
          "legendFormat": "5xx {{ endpoint }}",
          "refId": "B"
        }
      ]
    },
    {
      "id": 4,
      "title": "P95 Latency",
      "description": "95th percentile response latency in milliseconds by endpoint",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 12, "y": 1 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "latency",
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "ms",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 200 },
              { "color": "red", "value": 500 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "histogram_quantile(0.95, sum(rate(dps_api_request_duration_seconds_bucket{tenant_id=~\"$tenant_id\", endpoint=~\"$endpoint\"}[5m])) by (le, endpoint)) * 1000",
          "legendFormat": "{{ endpoint }}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 5,
      "title": "Active DB Connections",
      "description": "Current active PostgreSQL database connections",
      "type": "gauge",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 1 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "short",
          "min": 0,
          "max": 200,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 120 },
              { "color": "orange", "value": 160 },
              { "color": "red", "value": 180 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "text": {}
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "pg_stat_activity_count{datname=\"dps_dev\", state=\"active\"}",
          "legendFormat": "Active",
          "refId": "A"
        }
      ]
    },
    {
      "id": 10,
      "type": "row",
      "title": "Business Metrics",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 },
      "panels": []
    },
    {
      "id": 11,
      "title": "Active Contracts",
      "description": "Total number of currently active financial contracts",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 6, "w": 4, "x": 0, "y": 10 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "blue", "value": null }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "dps_contracts_active_total{tenant_id=~\"$tenant_id\"}",
          "legendFormat": "Active Contracts",
          "refId": "A"
        }
      ]
    },
    {
      "id": 12,
      "title": "Contracts by Status",
      "description": "Distribution of contracts across statuses",
      "type": "piechart",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 8, "x": 4, "y": 10 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "short",
          "mappings": []
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "ACTIVE" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "IN_ARREARS" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "CLOSED" }, "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "WRITTEN_OFF" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "RESTRUCTURED" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "DRAFT" }, "properties": [{ "id": "color", "value": { "fixedColor": "grey", "mode": "fixed" } }] }
        ]
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "right", "values": ["value", "percent"] },
        "tooltip": { "mode": "single", "sort": "none" },
        "pieType": "donut",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "displayLabels": ["percent"]
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(dps_contracts_by_status{tenant_id=~\"$tenant_id\"}) by (status)",
          "legendFormat": "{{ status }}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 13,
      "title": "Daily Disbursements",
      "description": "Total loan disbursement amounts per day",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 12, "y": 10 },
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "green", "mode": "fixed" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "amount",
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "lineWidth": 1,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["sum"], "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(increase(dps_disbursements_total_amount{tenant_id=~\"$tenant_id\"}[1d]))",
          "legendFormat": "Disbursements",
          "refId": "A"
        }
      ]
    },
    {
      "id": 14,
      "title": "Daily Collections",
      "description": "Total payment collection amounts per day",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 10 },
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "blue", "mode": "fixed" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "amount",
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "lineWidth": 1,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["sum"], "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(increase(dps_collections_total_amount{tenant_id=~\"$tenant_id\"}[1d]))",
          "legendFormat": "Collections",
          "refId": "A"
        }
      ]
    },
    {
      "id": 20,
      "type": "row",
      "title": "Portfolio Health",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 },
      "panels": []
    },
    {
      "id": 21,
      "title": "Aging Distribution",
      "description": "Contract aging bucket distribution: CURRENT, 30, 60, 90, 180, 180+ days overdue",
      "type": "barchart",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 19 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "short",
          "mappings": []
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "CURRENT" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "30" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "60" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "90" }, "properties": [{ "id": "color", "value": { "fixedColor": "dark-orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "180" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "180+" }, "properties": [{ "id": "color", "value": { "fixedColor": "dark-red", "mode": "fixed" } }] }
        ]
      },
      "options": {
        "orientation": "horizontal",
        "barWidth": 0.8,
        "groupWidth": 0.7,
        "stacking": "none",
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "single", "sort": "none" },
        "xTickLabelRotation": 0,
        "showValue": "always"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(dps_portfolio_aging_bucket{tenant_id=~\"$tenant_id\"}) by (bucket)",
          "legendFormat": "{{ bucket }}",
          "refId": "A",
          "format": "table",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [{ "field": "bucket", "desc": false }]
          }
        }
      ]
    },
    {
      "id": 22,
      "title": "Overdue Amount",
      "description": "Total outstanding overdue amount across all contracts",
      "type": "gauge",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 4, "x": 8, "y": 19 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "currencyUSD",
          "thresholds": {
            "mode": "percentage",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 30 },
              { "color": "orange", "value": 60 },
              { "color": "red", "value": 80 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "text": {}
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(dps_portfolio_overdue_amount{tenant_id=~\"$tenant_id\"})",
          "legendFormat": "Overdue",
          "refId": "A"
        }
      ]
    },
    {
      "id": 23,
      "title": "Write-off Rate",
      "description": "Percentage of contracts written off relative to total closed contracts",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 12, "y": 19 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "percentunit",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0.03 },
              { "color": "orange", "value": 0.05 },
              { "color": "red", "value": 0.10 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(dps_contracts_by_status{tenant_id=~\"$tenant_id\", status=\"WRITTEN_OFF\"}) / sum(dps_contracts_by_status{tenant_id=~\"$tenant_id\"})",
          "legendFormat": "Write-off Rate",
          "refId": "A"
        }
      ]
    },
    {
      "id": 24,
      "title": "Collection Rate",
      "description": "Ratio of collected amount to expected amount for due installments",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 19 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "percentunit",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "orange", "value": 0.70 },
              { "color": "yellow", "value": 0.85 },
              { "color": "green", "value": 0.95 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(dps_collections_total_amount{tenant_id=~\"$tenant_id\"}) / sum(dps_installments_due_amount{tenant_id=~\"$tenant_id\"})",
          "legendFormat": "Collection Rate",
          "refId": "A"
        }
      ]
    },
    {
      "id": 30,
      "type": "row",
      "title": "Reservations",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
      "panels": []
    },
    {
      "id": 31,
      "title": "Active Reservations",
      "description": "Total number of reservations currently in HOLD or CONFIRMED status",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 28 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "blue", "value": null }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(dps_reservations_active{tenant_id=~\"$tenant_id\"})",
          "legendFormat": "Active Reservations",
          "refId": "A"
        }
      ]
    },
    {
      "id": 32,
      "title": "Hold to Confirm Conversion Rate",
      "description": "Percentage of HOLD reservations that transition to CONFIRMED",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 28 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "percentunit",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "orange", "value": 0.50 },
              { "color": "yellow", "value": 0.70 },
              { "color": "green", "value": 0.85 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(dps_reservations_confirmed_total{tenant_id=~\"$tenant_id\"}[1h])) / sum(rate(dps_reservations_created_total{tenant_id=~\"$tenant_id\"}[1h]))",
          "legendFormat": "Conversion Rate",
          "refId": "A"
        }
      ]
    },
    {
      "id": 33,
      "title": "Average Hold Duration",
      "description": "Mean time a reservation stays in HOLD status before confirmation or expiry",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 28 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "m",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 30 },
              { "color": "orange", "value": 60 },
              { "color": "red", "value": 120 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "avg(dps_reservation_hold_duration_seconds{tenant_id=~\"$tenant_id\"}) / 60",
          "legendFormat": "Avg Hold Duration",
          "refId": "A"
        }
      ]
    },
    {
      "id": 34,
      "title": "Cancellation Rate",
      "description": "Percentage of reservations that end in CANCELLED status",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 28 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "percentunit",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0.15 },
              { "color": "orange", "value": 0.30 },
              { "color": "red", "value": 0.50 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "textMode": "auto",
        "orientation": "auto"
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(dps_reservations_cancelled_total{tenant_id=~\"$tenant_id\"}[1h])) / sum(rate(dps_reservations_created_total{tenant_id=~\"$tenant_id\"}[1h]))",
          "legendFormat": "Cancellation Rate",
          "refId": "A"
        }
      ]
    },
    {
      "id": 40,
      "type": "row",
      "title": "Infrastructure",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 34 },
      "panels": []
    },
    {
      "id": 41,
      "title": "PostgreSQL: Active Connections",
      "description": "Current active database connections by state",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 0, "y": 35 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "connections",
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "normal" }
          },
          "unit": "short"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "pg_stat_activity_count{datname=\"dps_dev\"} ",
          "legendFormat": "{{ state }}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 42,
      "title": "PostgreSQL: Queries/sec",
      "description": "Database query throughput per second",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 6, "y": 35 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "queries/s",
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "ops"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(pg_stat_database_xact_commit{datname=\"dps_dev\"}[5m])) + sum(rate(pg_stat_database_xact_rollback{datname=\"dps_dev\"}[5m]))",
          "legendFormat": "Total Queries/s",
          "refId": "A"
        },
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(pg_stat_database_xact_commit{datname=\"dps_dev\"}[5m]))",
          "legendFormat": "Commits/s",
          "refId": "B"
        },
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(pg_stat_database_xact_rollback{datname=\"dps_dev\"}[5m]))",
          "legendFormat": "Rollbacks/s",
          "refId": "C"
        }
      ]
    },
    {
      "id": 43,
      "title": "PostgreSQL: Cache Hit Ratio",
      "description": "Buffer cache hit ratio. Should be above 95% for healthy operation.",
      "type": "gauge",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 12, "y": 35 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "percentunit",
          "decimals": 2,
          "min": 0,
          "max": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "orange", "value": 0.90 },
              { "color": "yellow", "value": 0.95 },
              { "color": "green", "value": 0.99 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": true,
        "showThresholdMarkers": true,
        "text": {}
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "pg_stat_database_blks_hit{datname=\"dps_dev\"} / (pg_stat_database_blks_hit{datname=\"dps_dev\"} + pg_stat_database_blks_read{datname=\"dps_dev\"})",
          "legendFormat": "Cache Hit Ratio",
          "refId": "A"
        }
      ]
    },
    {
      "id": 44,
      "title": "PostgreSQL: Table Sizes (Top 10)",
      "description": "Largest tables by total size including indexes",
      "type": "table",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 18, "y": 35 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "decbytes",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 104857600 },
              { "color": "red", "value": 1073741824 }
            ]
          },
          "mappings": []
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "relname" },
            "properties": [{ "id": "custom.width", "value": 200 }]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "desc": true, "displayName": "Value" }],
        "cellHeight": "sm",
        "footer": { "show": false }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "topk(10, pg_total_relation_size_bytes{datname=\"dps_dev\"})",
          "legendFormat": "{{ relname }}",
          "refId": "A",
          "format": "table",
          "instant": true
        }
      ]
    },
    {
      "id": 51,
      "title": "Redis: Connected Clients",
      "description": "Number of currently connected Redis clients",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 0, "y": 42 },
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "purple", "mode": "fixed" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "clients",
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "short"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "redis_connected_clients",
          "legendFormat": "Connected Clients",
          "refId": "A"
        }
      ]
    },
    {
      "id": 52,
      "title": "Redis: Hit Rate",
      "description": "Redis cache hit ratio. Higher is better.",
      "type": "gauge",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 6, "y": 42 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "unit": "percentunit",
          "decimals": 2,
          "min": 0,
          "max": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "orange", "value": 0.80 },
              { "color": "yellow", "value": 0.90 },
              { "color": "green", "value": 0.95 }
            ]
          },
          "mappings": []
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": true,
        "showThresholdMarkers": true,
        "text": {}
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "redis_keyspace_hits_total / (redis_keyspace_hits_total + redis_keyspace_misses_total)",
          "legendFormat": "Hit Rate",
          "refId": "A"
        }
      ]
    },
    {
      "id": 53,
      "title": "Redis: Memory Usage",
      "description": "Redis used memory and configured max memory",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 12, "y": 42 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "memory",
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "decbytes"
        },
        "overrides": []
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "redis_memory_used_bytes",
          "legendFormat": "Used Memory",
          "refId": "A"
        },
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "redis_memory_max_bytes",
          "legendFormat": "Max Memory",
          "refId": "B"
        }
      ]
    },
    {
      "id": 54,
      "title": "Kafka: Messages/sec & Consumer Lag",
      "description": "Kafka message throughput and consumer group lag",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "gridPos": { "h": 7, "w": 6, "x": 18, "y": 42 },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisLabel": "",
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "scheme",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": { "group": "A", "mode": "none" }
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byRegexp", "options": ".*Lag.*" },
            "properties": [
              { "id": "custom.axisPlacement", "value": "right" },
              { "id": "custom.axisLabel", "value": "lag (messages)" },
              { "id": "custom.drawStyle", "value": "bars" },
              { "id": "custom.fillOpacity", "value": 40 }
            ]
          },
          {
            "matcher": { "id": "byRegexp", "options": ".*Messages.*" },
            "properties": [
              { "id": "custom.axisLabel", "value": "msg/s" },
              { "id": "unit", "value": "ops" }
            ]
          }
        ]
      },
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(rate(kafka_server_brokertopicmetrics_messagesin_total[5m]))",
          "legendFormat": "Messages In/s",
          "refId": "A"
        },
        {
          "datasource": { "type": "prometheus", "uid": "${datasource}" },
          "expr": "sum(kafka_consumergroup_lag) by (consumergroup)",
          "legendFormat": "Lag: {{ consumergroup }}",
          "refId": "B"
        }
      ]
    }
  ],
  "links": [
    {
      "title": "DPS API Documentation",
      "url": "https://docs.dps.local/api",
      "icon": "doc",
      "type": "link",
      "tooltip": "Open API Specification",
      "targetBlank": true
    },
    {
      "title": "DPS Runbooks",
      "url": "https://wiki.dps.local/runbooks",
      "icon": "book",
      "type": "link",
      "tooltip": "Operational Runbooks",
      "targetBlank": true
    }
  ]
}